#Move Player 1
#Mögliche Züge 

#Dialog for choosing a model (single) of a certain model type
CC "CoreUI" MODEL_SELECT_BOX modeltype:"all"
#Assignment of the model IDs to a variable
SET selectedmodelid:(VAL modelids)
#Determine wheter a model is loaded (cf. Mulit-User)
CC "Core" IS_MODEL_LOADED modelid:(selectedmodelid)
#Assignment of the loading state to a variable
SET wasloaded: (isoloaded)
#Load the model if necessary
#IF (NOT wasloaded){
#    CC "Core" LOAD_MODEL modelid:(selectedmodelid)
#}
CC "Core" LOAD_MODEL modelid:(selectedmodelid)
#--------------------------------------------






CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(selectedmodelid) classname:"Player"
SET player_c_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Player"
SET player_c_id:(classid)

CC "Core" GET_ATTR_ID classid:(player_c_id) attrname:"active_piece"
SET activep_a_id:(attrid)



#------------------------------------------------------------------------------------

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(selectedmodelid) classname:"Piece"
SET pieces_c_obj:(objids)

CC "Core" GET_CLASS_ID classname:"Piece"
SET piece_c_id:(classid)

CC "Core" GET_ATTR_ID classid:(piece_c_id) attrname:"PosX"
SET posx_a_id:(attrid)  

CC "Core" GET_ATTR_ID classid:(piece_c_id) attrname:"PosY"
SET posy_a_id:(attrid)  

CC "Core" GET_ATTR_ID classid:(piece_c_id) attrname:"PosY"
SET posy_a_id:(attrid)  
    
CC "Core" GET_ATTR_ID classid:(piece_c_id) attrname:"Status"
SET status_a_id:(attrid)

#-------------------------------------------------------------------------------



FOR i in:(player_c_obj) sep:" " {
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrid:(turn_a_id) attrname:"Turn"
    SET turn_a_val:(val)
    #CC "AdoScript" INFOBOX ("turn" + STR turn_a_val)
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrid:(team_a_id) attrname:"Team"
    SET team_a_val:(val)
    #CC "AdoScript" INFOBOX ("team" + team_a_val)
    

    IF ((turn_a_val = 1) AND (VAL team_a_val = 1)) {
        SET active_player: (i)
        SET direction: (1)
        
    }
    ELSIF ((turn_a_val = 1) AND (VAL team_a_val = 2)) {
        SET active_player: (i)
        SET direction: (-1)
        
    }
}
CC "Core" GET_ATTR_VAL objid:(VAL active_player) attrid:(team_a_id) attrname:"Team"
SET team_a_val:(val)

CC "Core" GET_ATTR_VAL objid:(VAL active_player) attrid:(activep_a_id) attrname:"active_piece"
SET activep_a_val:(val)
CC "AdoScript" INFOBOX ("acitve Piece " +  activep_a_val)





#------------------------------------------------------------------------------------

FOR i in:(pieces_c_obj) sep:" " {
    IF (VAL activep_a_val =  VAL i) {
        CC "Core" GET_ATTR_VAL objid:(VAL i) attrid:(posx_a_id) attrname:"PosX"
        SETG posx_a_val:(val)

        #CC "AdoScript" INFOBOX ("X" +  posx_a_val) 
            
        CC "Core" GET_ATTR_VAL objid:(VAL i) attrid:(posy_a_id) attrname:"PosY"
        SETG posy_a_val:(val)

        #CC "AdoScript" INFOBOX ("Y" +  posy_a_val)
    }
}

#CC "AdoScript" INFOBOX ("posy_a_val " +   posy_a_val)
#CC "AdoScript" INFOBOX ("posx_a_val " +   posx_a_val)

#------------------------------------------------------------------------------------



SET piece_l_obj:""
SET otherpiece_l_obj:""
SET moveLeft_o_obj:""
SET moveRight_o_obj:""
SET captureLeft_o_obj:""
SET captureRight_o_obj:""

          
FOR i in:(pieces_c_obj) sep:" " {
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"PosX"
    SET posx_a_val_i:(val) 
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"PosY"
    SET posy_a_val_i:(val) 
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"Status"
    SET status_a_val:(val)

    #CC "AdoScript" INFOBOX ("i " +  i)
    #CC "AdoScript" INFOBOX ("status_a_val " +  status_a_val)
    #CC "AdoScript" INFOBOX ("posy_a_val " +   posy_a_val)
    #CC "AdoScript" INFOBOX ("posx_a_val " +   posx_a_val)
    #CC "AdoScript" INFOBOX ("posy_a_val_i " +  posy_a_val_i)
    #CC "AdoScript" INFOBOX ("posx_a_val_i " +  posx_a_val_i)
    #CC "AdoScript" INFOBOX ("direction " + STR  direction)


    IF ((VAL status_a_val = 0) AND (((VAL posy_a_val + direction) = (VAL posy_a_val_i)) AND ((VAL posx_a_val+1 = VAL posx_a_val_i) OR (VAL posx_a_val-1 = VAL posx_a_val_i))))   {
        SET piece_l_obj:(tokunion(piece_l_obj,(i), " "))
        #CC "AdoScript" INFOBOX (piece_l_obj)

    }
    ELSIF  ((VAL status_a_val != VAL team_a_val OR 0) AND ((VAL posy_a_val + direction = VAL posy_a_val_i) AND (VAL posx_a_val-1 = VAL posx_a_val_i))) {
        SET moveLeft_o_obj:(i)
        SET captureLeft_o_obj:(i)
        #CC "AdoScript" INFOBOX (captureLeft_o_obj)
        #CC "AdoScript" INFOBOX (moveLeft_o_obj)
    }
    ELSIF  ((VAL status_a_val != VAL team_a_val OR 0) AND ((VAL posy_a_val + direction = VAL posy_a_val_i) AND (VAL posx_a_val+1 = VAL posx_a_val_i))) {
        SET moveRight_o_obj:(i)
        SET captureRight_o_obj:(i)
    }
}
   
FOR i in:(moveLeft_o_obj) sep:" " {
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"PosX"
    SET moveLeftPosx_a_val_i:(val) 
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"PosY"
    SET moveLeftPosy_a_val_i:(val) 
        
    FOR j in:(pieces_c_obj) sep:" " {
        CC "Core" GET_ATTR_VAL objid:(VAL j) attrname:"PosX"
        SET posx_a_val_i:(val) 
        CC "Core" GET_ATTR_VAL objid:(VAL j) attrname:"PosY"
        SET posy_a_val_i:(val) 
        CC "Core" GET_ATTR_VAL objid:(VAL j) attrname:"Status"
        SET status_a_val:(val)

    IF ((VAL status_a_val = 0) AND ((VAL moveLeftPosy_a_val_i + direction = VAL posy_a_val_i) AND (VAL moveLeftPosx_a_val_i-1 = VAL posx_a_val_i))) {
        SET piece_l_obj:(tokunion(piece_l_obj,(j), " "))
        SET moveLeft_o_obj:(j)
        #CC "AdoScript" INFOBOX (intermediate_l_obj)
    }
}
}
FOR i in:(moveRight_o_obj) sep:" " {
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"PosX"
    SET moveRightPosx_a_val_i:(val) 
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrname:"PosY"
    SET moveRigthPosy_a_val_i:(val) 
        
    FOR j in:(pieces_c_obj) sep:" " {
        CC "Core" GET_ATTR_VAL objid:(VAL j) attrname:"PosX"
        SET posx_a_val_i:(val) 
        CC "Core" GET_ATTR_VAL objid:(VAL j) attrname:"PosY"
        SET posy_a_val_i:(val) 
        CC "Core" GET_ATTR_VAL objid:(VAL j) attrname:"Status"
        SET status_a_val:(val)

    IF ((VAL status_a_val = 0) AND ((VAL moveRigthPosy_a_val_i + direction = VAL posy_a_val_i) AND (VAL moveRightPosx_a_val_i+1 = VAL posx_a_val_i))) {
        SET piece_l_obj:(tokunion(piece_l_obj,(j), " "))
        SET moveRight_o_obj:(j)
        #CC "AdoScript" INFOBOX (intermediate_l_obj)
    }
    }
}





#------------------------------------------------------------------------------------





CC "AdoScript" LISTBOX  entries:(piece_l_obj)
                        toksep:" "
                        title:"Example!"
                        oktext:"Click me!"
                        boxtext:"Choose your entry:"
                        selection:"Second Entry"
IF (endbutton = "ok") {
   CC "AdoScript" INFOBOX (selection)
}
SET moved_piece:(selection)

CC "AdoScript" INFOBOX (moved_piece + "moved piece")
#CC "AdoScript" INFOBOX (moveLeft_o_obj+ "move left obj" )

IF (VAL moved_piece = VAL moveLeft_o_obj) {
    CC "Core" SET_ATTR_VAL objid:(VAL captureLeft_o_obj) attrid:(status_a_id) val:"0"
}
ELSIF (VAL moved_piece = VAL moveRight_o_obj) {
    CC "Core" SET_ATTR_VAL objid:(VAL captureRight_o_obj) attrid:(status_a_id) val:"0"
}

CC "Core" SET_ATTR_VAL objid:(VAL moved_piece) attrid:(status_a_id) val:(VAL team_a_val)
CC "Core" SET_ATTR_VAL objid:(VAL activep_a_val) attrid:(status_a_id) val:"0"




