# Version: 1.0.0
# Date: ....
# Author: Daniel von Känel

(*
Possible dependencies: 
ASC_GlobalFunctions_Conversion (1.8, startup)
ASC_GlobalFunctions_MapSupport (1.8, startup)
ASC_GlobalFunctions_StringSupport (1.8, startup)
ASC_GlobalFunctions_JSON (1.8, startup)
ASC_GlobalProcedures_ExecuteFlowchart
ASC_GlobalProcedures_ExecAttrProf-beeup
ASC_GlobalVariables_FC
ASC_HttpRequestDll

Startup:
    EXECUTE file:("db:\\ASC_GlobalFunctions_Conversion.asc")
    EXECUTE file:("db:\\ASC_GlobalFunctions_DateTime.asc")
    EXECUTE file:("db:\\ASC_GlobalFunctions_JSON.asc")
    EXECUTE file:("db:\\ASC_GlobalFunctions_MapSupport.asc")
    EXECUTE file:("db:\\ASC_GlobalFunctions_RandomDistributions.asc")
    EXECUTE file:("db:\\ASC_GlobalFunctions_StringSupport.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_AutoStart.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_CloneUI.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_Cloning.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_ConfigFiles.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_Logging.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_ExecAsc.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_ExecAttrProf.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_ExtensionManagement.asc")
    EXECUTE file:("db:\\ASC_GlobalProcedures_RecordSupport.asc")
    EXECUTE file:("db:\\ASC_Bridge_HttpRequestDll.asc") # Kept for backwards compatibility
    EXECUTE file:("db:\\ASC_OliveIntegration_GlobalProcedures.asc")

############---------------- MY CODE ----------------############
    CC "AdoScript" FREAD file:"C:\\Users\\Daniel\\Documents\\GitHub\\metamodeling\\1_MA_dep.asc"
    EXECUTE (text)
############---------------- MY CODE ----------------############

*)

# TODO: 
(*
Could be useful
    val_fc_delay
    val_fc_printtimes
    val_fc_highlight
*) 

#------------------------------#_____get active model_____#------------------------------#

# Get and store the model id. It is also used for other things beside the output windows.
CC "Modeling" GET_ACT_MODEL
IF (ecode <> 0) {
  CC "AdoScript" ERRORBOX ("Encountered an error while trying to read the model information. Stopping script now.")
  EXIT
}
CC "Core" LOAD_MODEL (activeModelId)
SETG activeModelId: (modelid)

#------------------------------#_____get default information_____#------------------------------#

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Event"
SETL event_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Event"
SETL event_c_id:(classid)


CC "Core" GET_ATTR_ID classid:(event_c_id) attrname:"start"
SETL start_a_id:(attrid)

(*)(*)

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Intermediate"
SETL intermediate_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Intermediate"
SETL intermediate_c_id:(classid)
(*)
CC "Core" GET_ATTR_ID classid:(event_c_id) attrname:"Attribute X"
SETL x_a_id:(attrid)
(*)

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Pickup"
SETL pickup_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Pickup"
SETL pickup_c_id:(classid)

CC "Core" GET_ATTR_ID classid:(pickup_c_id) attrname:"Position"
SETL pickup_position_a_id:(attrid)


CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Function"
SETL function_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Function"
SETL function_c_id:(classid)

#we need a list...
SETG suctionA_l_id:""
SETG suctionB_l_id:""
SETG step_l_id:""



CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 1a" 
SETL suction1a_a_id:(attrid)
SETG suctionA_l_id:(tokunion(suctionA_l_id,(STR suction1a_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 1b"
SETL suction1b_a_id:(attrid)
SETG suctionB_l_id:(tokunion(suctionB_l_id,(STR suction1b_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 2a"
SETL suction2a_a_id:(attrid)
SETG suctionA_l_id:(tokunion(suctionA_l_id,(STR suction2a_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 2b"
SETL suction2b_a_id:(attrid)
SETG suctionB_l_id:(tokunion(suctionB_l_id,(STR suction2b_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 3a"
SETL suction3a_a_id:(attrid)
SETG suctionA_l_id:(tokunion(suctionA_l_id,(STR suction3a_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 3b"
SETL suction3b_a_id:(attrid)
SETG suctionB_l_id:(tokunion(suctionB_l_id,(STR suction3b_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 4a"
SETL suction4a_a_id:(attrid)
SETG suctionA_l_id:(tokunion(suctionA_l_id,(STR suction4a_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 4b"
SETL suction4b_a_id:(attrid)
SETG suctionB_l_id:(tokunion(suctionB_l_id,(STR suction4b_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 5a"
SETL suction5a_a_id:(attrid)
SETG suctionA_l_id:(tokunion(suctionA_l_id,(STR suction5a_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Suction Cup Action 5b"
SETL suction5b_a_id:(attrid)
SETG suctionB_l_id:(tokunion(suctionB_l_id,(STR suction5b_a_id), " "))


CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Step 1"
SETL step1_a_id:(attrid)
SETG step_l_id:(tokunion(step_l_id,(STR step1_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Step 2"
SETL step2_a_id:(attrid)
SETG step_l_id:(tokunion(step_l_id,(STR step2_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Step 3"
SETL step3_a_id:(attrid)
SETG step_l_id:(tokunion(step_l_id,(STR step3_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Step 4"
SETL step4_a_id:(attrid)
SETG step_l_id:(tokunion(step_l_id,(STR step4_a_id), " "))

CC "Core" GET_ATTR_ID classid:(VAL function_c_id) attrname:"Step 5"
SETL step5_a_id:(attrid)
SETG step_l_id:(tokunion(step_l_id,(STR step5_a_id), " "))


(*)
CC "Core" GET_ATTR_ID classid:(event_c_id) attrname:"Attribute X"
SETL x_a_id:(attrid)
(*)

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Storage"
SETL storage_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Storage"
SETL storage_c_id:(classid)
(*)
CC "Core" GET_ATTR_ID classid:(event_c_id) attrname:"Attribute X"
SETL x_a_id:(attrid)
(*)

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Waypoint"
SETL waypoint_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Waypoint"
SETL waypoint_c_id:(classid)
(*)
CC "Core" GET_ATTR_ID classid:(event_c_id) attrname:"Attribute X"
SETL x_a_id:(attrid)
(*)
    

CC "Core" GET_ALL_OBJS_OF_CLASSNAME modelid:(activeModelId) classname:"Item"
SETL item_l_obj:(objids)

CC "Core"  GET_CLASS_ID classname:"Item"
SETL item_c_id:(classid)

CC "Core" GET_ATTR_ID classid:(item_c_id) attrname:"Position"
SETL position_item_a_id:(attrid)



#------------------------------#_____prepare some attributes_____#------------------------------#
#------------------------------#_____prepare some attributes_____#------------------------------#
#------------------------------#_____prepare some attributes_____#------------------------------#


SETG eventActual_o_obj:""
SETG eventNext_o_obj:""
SETG areaActual_o_obj:""
SETG delay_val:(0.0)
SETG inside_l_obj:""
SETG x_step_name_str:"x"
SETG y_step_name_str:"y"
SETG z_step_name_str:"z"

SETG robo_outputwin_str:("Robo")
SETG robo_outputwin_str_debug:("Robo - debug")


#------------------------------#_____make some preparations_____#------------------------------#

# Remove any previous dyes if there are any in the model
CC "Modeling" UNDYE_ALL modelid:(activeModelId)

CC "AdoScript" CLOSE_DOCKABLE_WINDOW winid:(robo_outputwin_str)
CC "AdoScript" CLOSE_DOCKABLE_WINDOW winid:(robo_outputwin_str_debug)

CC "Core" GET_MODEL_INFO modelid:(activeModelId)
SETG modelname_str_obj:(modelname)
SETG version_str_obj:(ver)

CC "AdoScript" CREATE_OUTPUT_WIN winid:(robo_outputwin_str) title:(robo_outputwin_str + " - " + modelname_str_obj  + " " + version_str_obj)   

#------------------------------#_____get start of event_____#------------------------------#

#here we find the start element and set eventActual_o_obj
PROCEDURE global FIND_START_EVENT {
    FOR i in:(event_l_obj) sep:" " {
    CC "Core" GET_ATTR_VAL objid:(VAL i) attrid:(start_a_id) attrname:"start"
    SETL start_a_val:(val)
    
    IF (start_a_val = 1) {
        SETG eventActual_o_obj: (i)
    }
}
}


(*)TODO: If there is more than one 1 start available, 
        we should be able to get a box to chose which start we want to take. 
(*)


#------------------------------#_____find next event_____#------------------------------#

#here we find the next event and set eventNext_o_obj
PROCEDURE global FIND_NEXT_EVENT {  
    CC "Core" GET_CONNECTORS objid:(VAL eventActual_o_obj) out
    SETL connector_l_obj:(objids)

    CC "Core" GET_CONNECTORS objid:(VAL eventActual_o_obj) out
    SETL connector_l_obj:(objids)

    FOR i in:(connector_l_obj) sep:" " {
        CC "Core" GET_CONNECTOR_ENDPOINTS objid:(VAL i)
        SETL endpointToo_l_obj:(toobjid)
        #CC "AdoScript" INFOBOX (endpointToo_l_obj)
        CC "Core" GET_CLASS_ID objid:(VAL endpointToo_l_obj)
        SETL endpoint_c_id:(classid)
        CC "Core" GET_CLASS_NAME classid:(VAL endpointToo_l_obj)
        SETL endpoint_c_name:(classname)
        #CC "AdoScript" INFOBOX (endpoint_c_name)
        IF (endpoint_c_name = "Event" OR endpoint_c_name = "Intermediate") {
            SETG eventNext_o_obj:(endpointToo_l_obj)
        }
    }
}
#------------------------------#_____find actual area_____#------------------------------#

#here we find the area for actual event and set areaActual_o_obj
PROCEDURE global FIND_AREA_FOR_ACTUAL_EVENT {  
    CC "Core" GET_CONNECTORS objid:(VAL eventActual_o_obj) out
    SETL connector_l_obj:(objids)

    CC "Core" GET_CONNECTORS objid:(VAL eventActual_o_obj) out
    SETL connector_l_obj:(objids)

    FOR i in:(connector_l_obj) sep:" " {
        CC "Core" GET_CONNECTOR_ENDPOINTS objid:(VAL i)
        SETL endpointToo_l_obj:(toobjid)
        #CC "AdoScript" INFOBOX (endpointToo_l_obj)
        CC "Core" GET_CLASS_ID objid:(VAL endpointToo_l_obj)
        SETL endpoint_c_id:(classid)
        CC "Core" GET_CLASS_NAME classid:(VAL endpointToo_l_obj)
        SETL endpoint_c_name:(classname)
        #CC "AdoScript" INFOBOX (endpoint_c_name)
        IF (endpoint_c_name = "Pickup" OR endpoint_c_name = "Function" OR endpoint_c_name = "Storage") {
            SETG areaActual_o_obj:(endpointToo_l_obj)
        }
    }
}

#------------------------------#_____DYE the given object and move to it_____#------------------------------#

PROCEDURE global DYE_OBJECT integer:to_be_marked_o_obj {
    # "Find" the element that is to be executed. The benefit of FIND is that it also moves the view to the position of the element.
    # It is also used before the DYE so it doesn't automatically UNDYE the element.
        CC "Modeling" FIND objid:(to_be_marked_o_obj)
    # The DYE and UNDYE are useful to show where the execution has ended (e.g. when it ended prematurely).
    CC "Modeling" DYE (to_be_marked_o_obj) error-mark make-visible
    
}
  
#------------------------------#_____Create a delay_____#------------------------------#

PROCEDURE global MAKE_DELAY_MS integer:delay {
    SETL delay:((round(delay/10))*10)
    CC "AdoScript" SLEEP ms:(delay)
}


#------------------------------#_____Create a Ouput with Infos_____#------------------------------#

PROCEDURE global LOG_OUTPUT string:object1 object2:string {
  
    IF (object1 != "") {
        CC "Core" GET_CLASS_ID objid:(VAL object1)
        SETL object1_c_id:(classid)
        CC "Core" GET_CLASS_NAME classid:(VAL object1_c_id)
        SETL object1_c_name:(classname)

        CC "Core" GET_ATTR_ID classid:(VAL object1_c_id) attrname:"Name"
        SETL name_item_a_id:(attrid)
        CC "Core" GET_ATTR_VAL objid:(VAL object1) attrid:(name_item_a_id) as-string
        SETL object1_a_name:(val)

        CC "Application" GET_DATE_TIME date-format:"dd/mm/yyyy" time-format:"hh:mm:ss"
        SETL text_str:((object1_c_name) + " " + (object1_a_name) + " " + (date) + " " + (time) + "\n")

        CC "AdoScript" OUT winid:(robo_outputwin_str) text:(text_str)
    }
        IF (object2 != "") {
        CC "Core" GET_CLASS_ID objid:(VAL object2)
        SETL object2_c_id:(classid)
        CC "Core" GET_CLASS_NAME classid:(VAL object2_c_id)
        SETL object2_c_name:(classname)
    
        CC "Core" GET_ATTR_ID classid:(VAL object2_c_id) attrname:"Name"
        SETL name_item_a_id:(attrid)
        CC "Core" GET_ATTR_VAL objid:(VAL object2) attrid:(name_item_a_id) as-string
        SETL object2_a_name:(val)

        CC "Application" GET_DATE_TIME date-format:"dd/mm/yyyy" time-format:"hh:mm:ss"
        SETL text_str:((object2_c_name) + " " + (object2_a_name) + " " + (date) + " " + (time) + "\n")

        CC "AdoScript" OUT winid:(robo_outputwin_str) text:(text_str)
    }

}
#------------------------------#_____Clear a Ouput window_____#------------------------------#

PROCEDURE CLEAR_OUTPUT {
    CC "AdoScript" SET_OUT_MAX_LINE_COUNT 1
    CC "AdoScript" OUT winid:(robo_outputwin_str) text:("\n")
    CC "AdoScript" SET_OUT_MAX_LINE_COUNT 10000
}

#------------------------------#_____Determinate if a Item is inside the Pickup area_____#------------------------------#

PROCEDURE global FIND_ITEM_INSIDE_PICKUP integer:first_pickup_o_obj {
    #Here we get the position of the pickup area
    CC "Core" GET_ATTR_VAL objid:(first_pickup_o_obj) attrid:(pickup_position_a_id)
    SETL pickup_position_val:(val)
    LEO parse:(pickup_position_val) get-tmm-value:xp:"x" get-tmm-value:yp:"y" get-tmm-value:wp:"w" get-tmm-value:hp:"h"
    SETL xp:(CMS xp)
    SETL yp:(CMS yp)
    SETL wp:(CMS wp)
    SETL hp:(CMS hp)
    
    SETL xpwp: (xp + wp)
    SETL yphp: (yp + hp)

    #Here we get the positoin of the item 
    FOR i in:(item_l_obj) sep:" " {
        CC "Core" GET_ATTR_VAL objid:(VAL i) attrid:(position_item_a_id)
        SETL item_position_val:(val)
        LEO parse:(item_position_val) get-tmm-value:xi:"x" get-tmm-value:yi:"y" get-tmm-value:wi:"w" get-tmm-value:hi:"h"
        #Now we convert them
        SETL xi:(CMS xi)
        SETL yi:(CMS yi)
        SETL wi:(CMS wi)
        SETL hi:(CMS hi)
        SETL xiwi: (xi + wi)
        SETL yihi: (yi + hi)    
        #Let's compare item position with pickup position
        IF ((xp <= xi) AND (xpwp >= xi) AND 
            (yp <= yi) AND (yphp >= yi) AND
            (xp <= xiwi) AND (xpwp >= xiwi) AND
            (yp <= yihi) AND (yphp >= yihi)) {
            SETG inside_l_obj:(tokunion(inside_l_obj,(i), " "))
        }
        }
    }

#------------------------------#_____Pick up the item inside the pickup area_____#------------------------------#

PROCEDURE global PICKUP_ITEM_INSIDE_PICKUP string:proc_inside_l_obj {
    IF ((tokcnt(proc_inside_l_obj)) != 0) {
        CC "Core" GET_ATTR_VAL objid:(VAL proc_inside_l_obj) attrid:(position_item_a_id)
        SETL item_position_val:(val)
        LEO parse:(item_position_val) get-tmm-value:xi:"x" get-tmm-value:yi:"y" get-tmm-value:wi:"w" get-tmm-value:hi:"h"
        #Now we convert them
        SETL xi:(CMS xi)
        SETL yi:(CMS yi)
        SETL wi:(CMS wi)
        SETL hi:(CMS hi)
        SETL pickupX: (xi + (wi/2))
        SETL pickupY: (yi + (hi/2))
    }
    ELSE {
        CC "AdoScript" INFOBOX ("empty")
    }

    #
}

#------------------------------#_____Pick up the item inside the pickup area_____#------------------------------#

PROCEDURE global AREA_FUNCTION_ACTION integer:active_function_obj {

    #CC "AdoScript" INFOBOX (STR suctionA_l_id)
    #CC "AdoScript" INFOBOX (STR suctionB_l_id)
    #CC "AdoScript" INFOBOX (STR step_l_id)

    FOR i from:0 to:4 {
        
        CC "Core" GET_ATTR_VAL objid:(VAL active_function_obj) attrid:(VAL token(suctionA_l_id,VAL i," ")) as-string
        SETL suctionA_a_val:(val)

        FOR j from:1 to:3 {
            CC "Core" GET_REC_ATTR_ROW_ID objid:(VAL active_function_obj) attrid:(VAL token(step_l_id,VAL i," ")) index:(VAL j)
            SETL step_j_a_rowid:(rowid)

            IF (step_j_a_rowid != 0) {
                CC "Core" GET_ATTR_VAL objid:(VAL step_j_a_rowid) attrname:(x_step_name_str) as-string
                SETL step_j_a_x_val:(val)
                CC "Core" GET_ATTR_VAL objid:(VAL step_j_a_rowid) attrname:(y_step_name_str) as-string
                SETL step_j_a_y_val:(val)
                CC "Core" GET_ATTR_VAL objid:(VAL step_j_a_rowid) attrname:(z_step_name_str) as-string
                SETL step_j_a_z_val:(val)
                
                #CC "AdoScript" INFOBOX ("i " + STR i)
                CC "AdoScript" INFOBOX ("row " + STR step_j_a_rowid)
                CC "AdoScript" INFOBOX ("x " + STR step_j_a_x_val)
                CC "AdoScript" INFOBOX ("y " + STR step_j_a_y_val)
                CC "AdoScript" INFOBOX ("z " + STR step_j_a_z_val)
            }
        }
        CC "Core" GET_ATTR_VAL objid:(VAL active_function_obj) attrid:(VAL token(suctionB_l_id,VAL i," ")) as-string
        SETL suctionB_a_val:(val)

        
    }






    


    #CC "AdoScript" INFOBOX (active_function_obj)
    #CC "AdoScript" INFOBOX (step1_a_id)
    #CC "AdoScript" INFOBOX (active_function_obj)
    #CC "AdoScript" INFOBOX (step1_a_name)

}

(*)
      CC "Core" GET_ALL_REC_ATTR_ROW_IDS objid:(id_fc_curelement) attrid:(global_id_fc_reqvars)
      FOR str_rowid in:(rowids) {
        CC "Core" GET_ATTR_VAL objid:(VAL str_rowid) attrname:(global_str_fc_reqvar_name) as-string
        SETL str_varname:(val)
(*)


#------------------------------#_____Final code_____#------------------------------#


CLEAR_OUTPUT
FIND_START_EVENT
FIND_NEXT_EVENT
FIND_AREA_FOR_ACTUAL_EVENT
DYE_OBJECT (VAL eventActual_o_obj)
DYE_OBJECT (VAL areaActual_o_obj)
LOG_OUTPUT (STR eventActual_o_obj) object2:(STR "")
LOG_OUTPUT (STR eventActual_o_obj) object2:(STR areaActual_o_obj)
FIND_ITEM_INSIDE_PICKUP (VAL areaActual_o_obj)
PICKUP_ITEM_INSIDE_PICKUP (STR inside_l_obj)
SETG eventActual_o_obj:(eventNext_o_obj)
FIND_NEXT_EVENT
FIND_AREA_FOR_ACTUAL_EVENT
DYE_OBJECT (VAL eventActual_o_obj)
DYE_OBJECT (VAL areaActual_o_obj)
AREA_FUNCTION_ACTION (VAL areaActual_o_obj)







#TODO: Schritte wie folgt im notebook
# device
# step (3 mögliche linien - sollte eigentlich ausreichen)
# device 
# -> das ganze dann 5x sollte reichen für die meisten aktivitäten
# Device 1a, Device 1b
# Suction Cup Action 1a
# Step 1


(*)
CLEAR_OUTPUT
FIND_START_EVENT
FIND_NEXT_EVENT
FIND_AREA_FOR_ACTUAL_EVENT
DYE_OBJECT
MAKE_DELAY_MS
LOG_OUTPUT
CC "Modeling" UNDYE_ALL modelid:(activeModelId)
FIND_ITEM_INSIDE_PICKUP
PICKUP_ITEM_INSIDE_PICKUP
(*)


#CC "AdoScript" INFOBOX (eventActual_o_obj)
#CC "AdoScript" INFOBOX (eventNext_o_obj)
#CC "AdoScript" INFOBOX (areaActual_o_obj)


(*)

TODO: 
Remove Intermediate Event?
Waypoint auch ein Area?
Pickup -> random picking order or select which first?

TODO:

#EXECUTE_FUNCTION_AREA
#EXECUTE_STORAGE_AREA
#CREATE_ITEM
#DELETE_ITEM

(*)


#------------------------------#_____exampel_____#------------------------------#
(*)
# get all selected objects
CC "Modeling" GET_SELECTED
IF (objids = "")
{
   CC "AdoScript" ERRORBOX "Select a connector first!"
   EXIT
}


# from the list of selected objects, extract the first objectid
SET firstselected:(token(objids,0," "))

# now the all from and to instance
CC "Core" GET_CONNECTOR_ENDPOINTS objid:(VAL firstselected)
IF (ecode != 0)
{
   CC "AdoScript" ERRORBOX "Select a connector first!"
   EXIT
}

# now get the classes of the connected instances
CC "Core" GET_CLASS_ID objid:(fromobjid)
SET fromclassid:(classid)
CC "Core" GET_CLASS_ID objid:(toobjid)
SET toclassid:(classid)

# now get the names of the classes
CC "Core" GET_CLASS_NAME classid:(fromclassid)
SET fromclassname:(classname)
CC "Core" GET_CLASS_NAME classid:(toclassid)
SET toclassname:(classname)

# display the result
CC "AdoScript" INFOBOX ("You connected a " + fromclassname + " with a " + toclassname + ".")
